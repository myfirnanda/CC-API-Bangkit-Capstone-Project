FROM node:latest

WORKDIR /usr/src/app

# Default values for build-arg
ARG JWT_SECRET=jwt_secret
ARG DB_NAME=cc_api
ARG DB_USERNAME=root
ARG DB_PASSWORD=12345
ARG DB_HOST=34.101.143.127
ARG DB_DIALECT=mysql
ARG GCP_PROJECT_ID=capstone-api-406515
ARG GCP_KEY_FILENAME=eatwise-api-key.json
ARG GCP_STORAGE_BUCKET_NAME=eatwise-storage-bucket

# Set the environment variables using build-arg
ENV JWT_SECRET=$JWT_SECRET
ENV DB_NAME=$DB_NAME
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV DB_HOST=$DB_HOST
ENV DB_DIALECT=$DB_DIALECT
ENV GCP_PROJECT_ID=$GCP_PROJECT_ID
ENV GCP_KEY_FILENAME=$GCP_KEY_FILENAME
ENV GCP_STORAGE_BUCKET_NAME=$GCP_STORAGE_BUCKET_NAME

COPY package*.json ./

RUN npm install

COPY . .

EXPOSE 3000

CMD ["npm", "start"]
